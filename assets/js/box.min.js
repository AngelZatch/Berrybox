function onYouTubeIframeAPIReady(){player=new YT.Player("player",{height:"85%",width:"60%",videoId:"",events:{onReady:onPlayerReady,onStateChange:onPlayerStateChange}}),resizeElements()}function getBoxToken(){return/([a-z0-9]+$)/i.exec(document.location.href)[0]}function onPlayerReady(e){var s=getBoxToken();sessionStorage.setItem("currently-playing",""),synchronize(s)}function onPlayerStateChange(e){var s=getBoxToken();if(0!=window.autoplay&&e.data==YT.PlayerState.ENDED&&getNext(!1,s),e.data==YT.PlayerState.PLAYING){1e3*player.getDuration();-1!=user_token&&fetchMood(user_token,sessionStorage.getItem("currently-playing"))}}function addEntry(e,s,t){$.post("functions/post_history.php",{url:s,box_token:e,source:t}).done(function(e){if(console.log(e),"playlist"!=t)switch(e){case"ok":$("#body-chat").append("<p class='system-message system-success'><span class='glyphicon glyphicon-ok-sign'></span> "+language_tokens.song_submit_success+"</p>");break;case"error":$("#body-chat").append("<p class='system-message system-alert'><span class='glyphicon glyphicon-exclamation-sign'></span> "+language_tokens.invalid_link+"</p>");break;case"info":$("#body-chat").append("<p class='system-message system-alert'><span class='glyphicon glyphicon-exclamation-sign'></span> "+language_tokens.need_info+"</p>");break;default:requestCompletion(e)}return $("#body-chat").scrollTop($("#body-chat")[0].scrollHeight),e})}function getActiveWatchers(e){"none"!=$("#user-list").css("display")&&($.get("functions/get_user_list.php",{box_token:e}).done(function(e){var s=JSON.parse(e);$("#body-user-list").empty();for(var t=-1,n=0;n<s.length;n++){var o="";if(t!=s[n].power)switch(s[n].power){case"1":o+="<p class='list-rank'>"+language_tokens.ul_users+"</p>";break;case"2":o+="<p class='list-rank'>"+language_tokens.ul_admin+"</p>";break;case"3":o+="<p class='list-rank'>"+language_tokens.ul_mods+"</p>"}o+="<div class='row'>",o+="<p class='col-xs-10'>",o+=s[n].pseudo,o+="</p>",s[n].pseudo!=user_name&&2==user_power&&(o+="<p class='col-xs-1' title='"+language_tokens.transfer_box+"'><span class='glyphicon glyphicon-transfer button-glyph transfer-box' data-user='"+s[n].pseudo+"'></span></p>"),o+="</div>",t=s[n].power,$("#body-user-list").append(o)}}),setTimeout(getActiveWatchers,8e3,e))}function getBoxDetails(e){return $.get("functions/get_box_details.php",{box_token:e})}function getNext(e,s){if(1==e){var t="{skip}";sendMessage(s,4,3,t)}2==user_power?$.post("functions/get_next.php",{box_token:s,user_power:window.user_power,lastPlayed:sessionStorage.getItem("currently-playing")}).done(function(e){if(""!=e){var t=JSON.parse(e);null!=t.link&&playSong(t.index,t.link,t.title,0)}else synchronize(s)}):(synchronize(s),$(".sync-message").append("<span class='glyphicon glyphicon-refresh' title='"+language_tokens.synchronizing+"'> <span class='hidden-xs hidden-sm hidden-md'>"+language_tokens.synchronizing+"</span></span>"))}function joinBox(e,s){return $.post("functions/join_room.php",{box_token:e,user_token:s})}function loadPlaylist(e,s){s&&clearTimeout(refresh_playlist_timer),"none"!=$("#song-list").css("display")&&($("#playlist-filter").is(":focus")||$.post("functions/get_history.php",{box_token:e}).done(function(e){var s=JSON.parse(e),t=0,n=0;$("#body-song-list").empty();for(var o=-1,a=0;a<s.length;a++){var i="",l=s[a].videoName.replace(/'/g,"&#39");if(o!=s[a].videoStatus)switch(s[a].videoStatus){case"0":case"3":if(0==a){var r="<p class='list-rank' id='list-upcoming'>"+language_tokens.sl_upcoming+"</p>";$("#body-song-list").append(r)}break;case"1":i+="<p class='list-rank'>"+language_tokens.now_playing+"</p>";break;case"2":i+="<p class='list-rank' id='list-played'>"+language_tokens.sl_played+"</p>"}var c;if(2==s[a].videoStatus)i+="<div class='row playlist-entry song-played'>",c=10,n++;else if(1==s[a].videoStatus)i+="<div class='row playlist-entry song-playing'>",c=11;else if(3==s[a].videoStatus)i+="<div class='row playlist-entry song-ignored'>",c=10;else{var i="<div class='row playlist-entry song-upcoming'>";t++,c=10}2!=window.user_power&&3!=window.user_power&&c++,(2==window.user_power||3==window.user_power)&&("0"==s[a].videoStatus||"3"==s[a].videoStatus)&&(c-=2,i+="<div class='col-xs-1'>",0!=a&&(i+="<span class='glyphicon glyphicon-arrow-up button-glyph swap-order' id='up-"+s[a].entry+"' data-order='"+s[a].order+"' title='"+language_tokens.song_up+"'></span>"),i+="</div>",i+="<div class='col-xs-1'>",(0==s[a+1].videoStatus||3==s[a+1].videoStatus)&&(i+="<span class='glyphicon glyphicon-arrow-down button-glyph swap-order' id='down-"+s[a].entry+"' data-order='"+s[a].order+"' title='"+language_tokens.song_down+"'></span>"),i+="</div>"),i+="<div class='col-xs-"+c+"'>",i+="<p class='song-list-line'><a href='https://www.youtube.com/watch?v="+s[a].videoLink+"' target='_blank' title='"+l+"'>"+s[a].videoName+"</a></p></div>",1==window.room_state&&((2==window.user_power||3==window.user_power)&&(i+="<div class='col-xs-1'>",1==s[a].pending&&(i+="<span class='glyphicon glyphicon-pencil button-glyph' onClick=requestCompletion("+s[a].index+")></span>"),i+="</div>",i+="<div class='col-xs-1'>",0==s[a].videoStatus?i+="<span class='glyphicon glyphicon-ban-circle button-glyph ignore-video' id='ignore-"+s[a].entry+"' data-target='"+s[a].entry+"'></span>":3==s[a].videoStatus&&(i+="<span class='glyphicon glyphicon-ok-circle button-glyph reinstate-video' id='reinstate-"+s[a].entry+"' data-target='"+s[a].entry+"'></span>")),2==s[a].videoStatus&&-1!=user_token&&(2==window.room_submission_rights&&1!=user_power||1==window.room_submission_rights)&&(i+="<span class='glyphicon glyphicon-repeat button-glyph quick-requeue' id='quick-requeue-"+s[a].entry+"' data-target='"+s[a].entry+"'></span>"),i+="</div>"),i+="</div>",o=s[a].videoStatus,$("#body-song-list").append(i)}$("#list-upcoming").append(" ("+t+")"),$("#list-played").append(" ("+n+")")}),-1!=user_token&&($("#likes-filter").is(":focus")||$.get("functions/get_likes.php",{user_token:user_token}).done(function(e){var s=JSON.parse(e);$("#body-song-likes").empty();for(var t=0;t<s.length;t++){var n="",o=s[t].video_name.replace(/'/g,"&#39");n+="<div class='row likes-entry'>",n+="<div class='col-xs-11'>",n+="<p class='song-list-line'>",n+="<span class='glyphicon glyphicon-"+s[t].key_icon+" emotion-"+s[t].key_mood+"'></span> ",n+="<a href='"+s[t].video_link+"' target='_blank' title='"+o+"'>"+s[t].video_name+"</a></p></div>",1==window.room_state&&(n+="<span class='glyphicon glyphicon-circle-arrow-right button-glyph quick-submit' id='quick-submit-"+s[t].video_id+"' data-target='"+s[t].video_id+"'></span>"),n+="</div>",$("#body-song-likes").append(n)}})),refresh_playlist_timer=setTimeout(loadPlaylist,8e3,e,!1))}function playSong(e,s,t,n){var o=getBoxToken();if(0!=n){var a=moment.utc(n).add(7,"s"),i=moment(a).local(),l=Math.round(moment().diff(i)/1e3);0>l&&(l=0),player.loadVideoById(s,l)}else player.loadVideoById(s,0);if($(".sync-message").empty(),sessionStorage.setItem("currently-playing",e),document.title=t+" | Berrybox",$(".currently-name").empty(),$(".currently-name").html(t),user_token==box_details.room_creator&&(0==n||3>=l)){var r="{now_playing}"+t;sendMessage(o,4,2,r),$.post("functions/register_song.php",{index:e})}displayMoodVotes(e)}function requeueSong(e,s){$.post("functions/requeue_song.php",{box_token:e,video_id:s,user_token:user_token}).done(function(s){console.log(s),"1"==s?$("#body-chat").append("<p class='system-message system-success'><span class='glyphicon glyphicon-ok-sign'></span> "+language_tokens.song_submit_success+"</p>"):$("#body-chat").append("<p class='system-message system-warning'></span class='glyphicon glyphicon-question-sign'></span> "+language_tokens.no_fetch+"</p>"),$("#body-chat").scrollTop($("#body-chat")[0].scrollHeight),loadPlaylist(e,!0)})}function shufflePlaylist(e){$.get("functions/playlist_shuffle.php",{box_token:e}).done(function(s){console.log(s),loadPlaylist(e,!0),$("#body-chat").append("<p class='system-message'><span class='glyphicon glyphicon-question-sign'></span> "+language_tokens.playlist_shuffled+"</p>")})}function submitLink(){$(".submit-warning").empty();var e=getBoxToken(),s=$(".url-box").val();if(""!=s){var t=new RegExp(/list=([a-z0-9\-\_]+)\&?/i),n=t.exec(s);if(null!=n){pID=n[1],$(".under-video").append("<div class='modal-body' id='sec-player' style='display:none;'></div>");var o;o=new YT.Player("sec-player",{height:"5",width:"5",videoId:"",events:{onReady:onSecPlayerReady,onStateChange:onSecPlayerStateChange}})}else{var a=new RegExp(/\?v=([a-z0-9\-\_]+)\&?/i),i=a.exec(s);if(null==i){var l=new RegExp(/\.be\/([a-z0-9\-\_]+)\&?/i);i=l.exec(s)}var r=i[1];addEntry(e,r,"solo"),$(".url-box").val("")}}}function synchronize(e){$.post("functions/load_current.php",{box_token:e,user_power:window.user_power}).done(function(s){var t=JSON.parse(s);null!=t.link&&t.index!=sessionStorage.getItem("currently-playing")?playSong(t.index,t.link,t.title,t.timestart):window.videoPending=setTimeout(synchronize,3e3,e)})}function userState(e,s){$.get("functions/get_user_state.php",{box_token:e,user_token:s}).done(function(e){var s=JSON.parse(e);if(2==s.room_user_state||3==s.room_user_state){if($(".playlist-actions").is(":empty")){var t="<button class='btn btn-default btn-admin btn-skip col-xs-6'><span class='glyphicon glyphicon-step-forward resize-lg'></span> <span class='hidden-xs hidden-sm hidden-md'> "+language_tokens.skip+"</span></button>";t+="<button class='btn btn-default btn-admin shuffle-playlist col-xs-6'><span class='glyphicon glyphicon-random resize-lg'></span> <span class='hidden-xs hidden-sm hidden-md'> "+language_tokens.shuffle+"</span></button>",$(".playlist-actions").append(t)}}else $(".playlist-actions").empty();window.user_power=s.room_user_state,4==s.room_user_state&&setTimeout(function(){window.location.replace("home")},3e3)})}function toggleVideoInQueue(e,s,t){$.post("functions/toggle_video_in_queue.php",{box_token:e,video_id:s,play_flag:t}).done(function(s){if(0==t){var n="{song_reinstated}"+s;sendMessage(e,4,6,n,null)}if(3==t){var n="{song_ignored}"+s;sendMessage(e,4,5,n,null)}loadPlaylist(e,!0)})}function transferBox(e,s){$.post("functions/transfer_box.php",{box_token:e,user_target:s}).done(function(){watchBoxState(e);var t=s+" "+language_tokens.box_transfered;sendMessage(e,4,1,t)})}function watchBoxState(e){window.box_watch_time&&clearTimeout(window.box_watch_time),$.get("functions/get_box_status.php",{box_token:e}).done(function(s){var t=JSON.parse(s);if(userState(e,window.user_token),$("#room-title").text(t.room_name),$(".creator-views").text(t.stat_visitors),$(".creator-followers").text(t.stat_followers),t.user_pseudo!=$("#box-creator-link").text()){if(t.user_pseudo==window.user_name){$(".btn-toggle-follow").remove();var n="<div class='admin-options'>";n+="<div role='separator' class='divider options-divider'></div>",n+="<p class='options-title'>"+language_tokens.creator_options+"</p>",n+="<div class='room-option'>",n+="<p class='option-title'>"+language_tokens.play_type+"</p>",n+="<span class='tip'>"+language_tokens.play_type_tip+"</span>",n+="<div class='row'>",n+="<div class='col-lg-6'>",n+="<span class='btn btn-primary btn-block btn-switch toggle-box-state' id='select-automatic' data-field='room_play_type' data-value='1' data-twin='select-manual'>",n+="<span class='glyphicon glyphicon-play-circle'></span> ",n+=language_tokens.auto_play,n+="</span>",n+="</div>",n+="<div class='col-lg-6'>",n+="<span class='btn btn-primary btn-block btn-switch toggle-box-state' id='select-manual' data-field='room_play_type' data-value='2' data-twin='select-automatic'>",n+="<span class='glyphicon glyphicon-hourglass'></span> ",n+=language_tokens.manual_play,n+="</span>",n+="</div>",n+="</div>",n+="</div>",n+="<div class='room-option'>",n+="<p class='option-title'>"+language_tokens.submit_type+"</p>",n+="<span class='tip'>"+language_tokens.submit_type_tip+"</span>",n+="<div class='row'>",n+="<div class='col-lg-6'>",n+="<span class='btn btn-primary btn-block btn-switch toggle-box-state' id='select-everyone' data-field='room_submission_rights' data-value='1' data-twin='select-mods-only'>",n+="<span class='glyphicon glyphicon-ok-sign'></span> ",n+=language_tokens.submit_all,n+="</span>",n+="</div>",n+="<div class='col-lg-6'>",n+="<span class='btn btn-primary btn-block btn-switch toggle-box-state' id='select-mods-only' data-field='room_submission_rights' data-value='2' data-twin='select-everyone'>",n+="<span class='glyphicon glyphicon-ok-circle'></span> ",n+=language_tokens.submit_mod,n+="</span>",n+="</div>",n+="</div>",n+="</div>",n+="<div class='room-option'>",n+="<p class='option-title'>"+language_tokens.room_protection+"</p>",n+="<span class='tip'>"+language_tokens.protection_tip+"</span>",n+="<div class='row'>",n+="<div class='col-lg-6'>",n+="<span class='btn btn-primary btn-block btn-switch toggle-box-state' id='select-public' data-field='room_protection' data-value='1' data-twin='select-private'>",n+="<span class='glyphicon glyphicon-volume-up'></span> ",n+=language_tokens.level_public,n+="</span>",n+="</div>",n+="<div class='col-lg-6'>",n+="<span class='btn btn-primary btn-block btn-switch toggle-box-state' id='select-private' data-field='room_protection' data-value='2' data-twin='select-public'>",n+="<span class='glyphicon glyphicon-headphones'></span> ",n+=language_tokens.level_private,n+="</span>",n+="</div>",n+="</div>",n+="</div>",n+="<div class='room-option'>",n+="<p class='option-title'>"+language_tokens.room_params+"</p>",n+="<span class='tip'>"+language_tokens.room_params_tip+"</span>",n+="<form class='form-horizontal' id='form-box-details'>",n+="<div class='form-group'>",n+="<label for='room_name' class='col-lg-4 control-label'>"+language_tokens.room_name+"</label>",n+="<div class='col-lg-8'><input type='text' name='room_name' class='form-control' value='"+t.room_name+"'></div>",n+="</div>",n+="<div class='form-group'>",n+="<label for='room_lang' class='col-lg-4 control-label'>"+language_tokens.speak_lang+"</label>",n+="<div class='col-lg-8'>",n+="<select name='room_lang' id='' class='form-control'>",n+="<option value='en'>"+language_tokens.lang_en+"</option>",n+="<option value='fr'>"+language_tokens.lang_fr+"</option>",n+="<option value='jp'>"+language_tokens.lang_jp+"</option>",n+="</select>",n+="</div>",n+="</div>",n+="<div class='form-group'>",n+="<label form='room_type' class='col-lg-4 control-label'>"+language_tokens.room_type+"</label>",n+="<div class='col-lg-8'>",n+="<select name='room_type' class='form-control' id='type-select'>",$.get("functions/fetch_box_types.php",{box_token:e}).done(function(e){for(var s=JSON.parse(e),t=0;t<s.length;t++)$("#type-select").append($("<option></option>").text(language_tokens[s[t].type]).val(s[t].id))}),n+="</select>",n+="</div>",n+="</div>",n+="<div class='form-group'>",n+="<label form='room_description' class='col-lg-4 control-label'>"+language_tokens.description_limit+"</label>",n+="<div class='col-lg-8'>",n+="<textarea name='room_description' cols='30' rows='5' class='form-control'>"+t.room_description+"</textarea>",n+="</div>",n+="</div>",n+="</form>",n+="<button class='btn btn-primary btn-block' id='save-room-button'>"+language_tokens.save_changes+"</button>",n+="</div>",$(".admin-options").empty(),$("#body-options-list").append(n)}else{console.log("you have lost admin"),$(".admin-options").empty(),$(".playlist-actions").empty();var o="",a="",i="";1==t.following_creator?(o="btn-unfollow btn-active",a="unfollow",i=language_tokens.following+" "+t.user_pseudo):(o="btn-follow",a="follow",i=language_tokens.follow+" "+t.user_pseudo);var l="<button class='btn btn-primary btn-toggle-follow "+o+"' id='box-title-"+a+"' value='"+t.user_pseudo+"'>";if(l+="<span class='glyphicon glyphicon-heart'></span>",l+="<span class='hidden-xs hidden-sm'> ",l+=i,l+="</span>",l+="</button>",0==$(".btn-toggle-follow").length&&$(".creator-stats").prepend(l),0==$(".user-options").length){var n="<div class='user-options'>";n+="<span class='option-title'>"+language_tokens.sync+"</span><br>",n+="<span class='tip'>"+language_tokens.sync_tip+"</span>",n+="<button class='btn btn-default btn-admin btn-block sync-on' id='btn-synchro'><span class='glyphicon glyphicon-refresh'></span> "+language_tokens.sync_on+"</button>",n+="</div>",$("#body-options-list").empty(),$("#body-options-list").append(n)}}$("#box-creator-link").attr("href","user/"+t.user_pseudo),$("#box-creator-link").text(t.user_pseudo),$("#box-creator-picture").attr("src","profile-pictures/"+t.user_pp),$("#box-creator-picture").attr("title",t.user_pseudo+" ("+language_tokens.room_admin+")")}2==t.room_submission_rights?(1==window.user_power&&($(".add-link").hide(),$(".room-quick-messages").addClass("col-sm-offset-4")),2==window.user_power&&window.submission&&sendMessage(e,4,1,"{submission_mod}"),window.submission=!1,$(".submission-message").html("<span class='glyphicon glyphicon-play-circle' title='"+language_tokens.submit_mod+"'></span> <span class='hidden-xs hidden-sm hidden-md'>"+language_tokens.submit_mod+"</span></div>"),$("#select-mods-only").trigger("activate")):(window.submission||2!=user_power||sendMessage(e,4,1,"{submission_all}"),window.submission=!0,$(".add-link").show(),$(".room-quick-messages").removeClass("col-sm-offset-4"),$(".submission-message").empty(),$("#select-everyone").trigger("activate")),window.room_submission_rights=t.room_submission_rights,2==t.room_protection?(1==window.protection&&2==user_power&&sendMessage(e,4,1,"{protect_private}"),window.protection=2,$(".protection-message").html("<span class='glyphicon glyphicon-headphones' title='"+language_tokens.level_private+"'></span> <span class='hidden-xs hidden-sm hidden-md'>"+language_tokens.level_private+"</span></div>"),$("#select-private").trigger("activate")):(2==window.protection&&2==user_power&&sendMessage(e,4,1,"{protect_public}"),window.protection=1,$(".protection-message").empty(),$("#select-public").trigger("activate")),1==t.room_play_type?(window.autoplay||2!=user_power||sendMessage(e,4,1,"{auto-on}"),window.autoplay=!0,$(".play-message").empty(),$("#select-automatic").trigger("activate")):(window.autoplay&&2==user_power&&sendMessage(e,4,1,"{auto-off}"),window.autoplay=!1,$(".play-message").html("<span class='glyphicon glyphicon-hourglass' title='"+language_tokens.manual_play+"'></span> <span class='hidden-xs hidden-sm hidden-md'>"+language_tokens.manual_play+"</span></div>"),$("#select-manual").trigger("activate")),0!=window.room_state&&0==t.room_active&&$("#body-chat").append("<p class='system-message'><span class='glyphicon glyphicon-info-sign'></span> "+language_tokens.room_closing+"</p>"),window.room_state=t.room_active,$("#watch-count").empty(),$("#watch-count").append(" "+t.present_watchers),box_watch_time=setTimeout(watchBoxState,1e4,e)})}var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);var player,refresh_playlist_timer;$(document).ready(function(){var e=getBoxToken();$.when(getBoxDetails(e)).done(function(s){window.box_details=JSON.parse(s),window.roomState=box_details.room_active,$.when(joinBox(e,user_token),getUserLang()).done(function(s,t){window.user_power=s[0],window.language_tokens=JSON.parse(t[0]),window.lang=language_tokens.user_lang,watchBoxState(e),2==user_power?$("#body-chat").append("<p class='system-message'>"+language_tokens.welcome_admin+"</p>"):$("#body-chat").append("<p class='system-message'>"+language_tokens.welcome+"</p>"),user_token!=box_details.room_creator?$.post("functions/check_creator.php",{box_token:e}).done(function(e){0==e&&$("#body-chat").append("<p class='system-message system-alert'>"+language_tokens.no_admin+"</p>")}):1==box_details.room_play_type?window.autoplay=!0:window.autoplay=!1,setInterval(function(){$.post("functions/refresh_session.php")},18e5),fetchEmotes().done(function(s){for(var t=JSON.parse(s),n=[],o=0;o<t.length;o++)n.push(t[o].emoteText);loadChat(e,user_token,n,window.lang)}),window.chatHovered=!1,window.showingMoods,window.hidingMoods})}),$("#playlist-filter").on("keyup",function(){var e=$(".playlist-entry"),s=$.trim($(this).val()).replace(/ +/g," ").toLowerCase();e.show().filter(function(){var e=$(this).text().replace(/\s+/g," ").toLowerCase();return!~e.indexOf(s)}).hide()}),$("#likes-filter").on("keyup",function(){var e=$(".likes-entry"),s=$.trim($(this).val()).replace(/ +/g," ").toLowerCase();e.show().filter(function(){var e=$(this).text().replace(/\s+/g," ").toLowerCase();return!~e.indexOf(s)}).hide()})}).on("mouseenter",".btn-unfollow",function(){var e=$(this).attr("id"),s=$(this).val();if($(this).hasClass("btn-card"))var t="<span class='glyphicon glyphicon-minus'></span> <span class='hidden-xs hidden-sm'></span>";else var t="<span class='glyphicon glyphicon-minus'></span> <span class='hidden-xs hidden-sm'>"+language_tokens.unfollow+" "+s+"</span>";$("#"+e).html(t),$("#"+e).removeClass("btn-active"),$("#"+e).addClass("btn-danger")}).on("mouseleave",".btn-unfollow",function(){var e=$(this).attr("id"),s=$(this).val();if($(this).hasClass("btn-card"))var t="<span class='glyphicon glyphicon-heart'></span> <span class='hidden-xs hidden-sm'></span>";else var t="<span class='glyphicon glyphicon-heart'></span> <span class='hidden-xs hidden-sm'>"+language_tokens.following+" "+s+"</span>";$("#"+e).html(t),$("#"+e).removeClass("btn-danger"),$("#"+e).addClass("btn-active")}).on("click",".btn-unfollow",function(){var e=$(this).attr("value"),s=$(this).attr("id");$.post("functions/unfollow_user.php",{userFollowing:user_token,userFollowed:e}).done(function(t){if($("#"+s).removeClass("btn-active"),$("#"+s).hasClass("btn-card"))var n="<span class='glyphicon glyphicon-heart'></span> <span class='hidden-xs hidden-sm'></span>";else var n="<span class='glyphicon glyphicon-heart'></span> <span class='hidden-xs hidden-sm'>"+language_tokens.follow+" "+e+"</span>";$("#"+s).html(n),$("#"+s).removeClass("btn-danger"),$("#"+s).removeClass("btn-unfollow"),$("#"+s).addClass("btn-follow"),$("#"+s).attr("id",s.substr(0,s.length-6)+"follow"),e==box_details.creator_pseudo&&($("#box-title-unfollow").removeClass("btn-active"),$("#box-title-unfollow").html(n),$("#box-title-unfollow").removeClass("btn-danger"),$("#box-title-unfollow").removeClass("btn-unfollow"),$("#box-title-unfollow").addClass("btn-follow"),$("#box-title-unfollow").attr("id","box-title-follow"))})}).on("click",".btn-follow",function(){var e=$(this).attr("value"),s=$(this).attr("id");$.post("functions/follow_user.php",{userFollowing:user_token,userFollowed:e}).done(function(t){if($("#"+s).addClass("btn-active"),$("#"+s).hasClass("btn-card"))var n="<span class='glyphicon glyphicon-heart'></span> <span class='hidden-xs hidden-sm'></span>";else var n="<span class='glyphicon glyphicon-heart'></span> <span class='hidden-xs hidden-sm'>"+language_tokens.following+" "+e+"</span>";$("#"+s).html(n),$("#"+s).removeClass("btn-follow"),$("#"+s).addClass("btn-unfollow"),$("#"+s).attr("id",s.substr(0,s.length-8)+"unfollow"),e==box_details.creator_pseudo&&($("#box-title-follow").addClass("btn-active"),$("#box-title-follow").html(n),$("#box-title-follow").removeClass("btn-follow"),$("#box-title-follow").addClass("btn-unfollow"),$("#box-title-follow").attr("id","box-title-unfollow"))})}).on("click",".play-url",function(){submitLink()}).on("focus",".url-box",function(){$(this).keypress(function(e){13==e.which&&($(this).hasClass("disabled")||submitLink())})}).on("click",".send-info",function(){fillInfo()}).on("click",".cancel-info",function(){var e=$(this).attr("id").substr(12);$("#warning-"+e).remove()}).on("focus",".info-box",function(){$(this).keypress(function(e){13==e.which&&fillInfo()})}).on("click",".color-cube",function(){var e=$(this),s=$(this).attr("id").substr(6,6);$.post("functions/change_color.php",{user_token:user_token,color:s}).done(function(){$(".close").click(),$(".color-cube").removeClass("cube-selected"),e.addClass("cube-selected")})}).on("click",".emotion-container",function(){if($(this).hasClass("selected"))var e=0;else var e=document.getElementById($(this).attr("id")).dataset.mood;voteMood(e,user_token,sessionStorage.getItem("currently-playing"))}).on("click",".ignore-video",function(){var e=document.getElementById($(this).attr("id")).dataset.target,s=getBoxToken();toggleVideoInQueue(s,e,3)}).on("click",".reinstate-video",function(){var e=document.getElementById($(this).attr("id")).dataset.target,s=getBoxToken();toggleVideoInQueue(s,e,0)}).on("click",".toggle-song-list, .toggle-menu-list, .toggle-user-list, .toggle-options-list",function(){var t,e=getBoxToken(),s=$(this).attr("class").split(" ")[4].substr(7),n="0px";if("none"==$("#"+s).css("display"))switch($("#"+s).toggle(),window.innerWidth>1024?t="25%":window.innerWidth<768?(t="0%",n=$("#heading-chat").offset().top+10):t="31.9%",s){case"song-list":loadPlaylist(e,!1),setTimeout(function(){$("#user-list").hide(),$("#menu-list").hide(),$("#options-list").hide()},200),$("#user-list").animate({right:"0px"},200),$("#menu-list").animate({right:"0px"},200),$("#options-list").animate({right:"0px"},200),jQuery(window).width()>992&&$("#currently-playing").animate({width:"68%"},200);break;case"user-list":getActiveWatchers(e),setTimeout(function(){$("#song-list").hide(),$("#menu-list").hide(),$("#options-list").hide()},200),$("#song-list").animate({right:"0px"},200),$("#menu-list").animate({right:"0px"},200),$("#options-list").animate({right:"0px"},200),jQuery(window).width()>992&&$("#currently-playing").animate({width:"79%"},200);break;case"menu-list":setTimeout(function(){$("#song-list").hide(),$("#user-list").hide(),$("#options-list").hide()},200),$("#song-list").animate({right:"0px"},200),$("#user-list").animate({right:"0px"},200),$("#options-list").animate({right:"0px"},200),jQuery(window).width()>992&&$("#currently-playing").animate({width:"79%"},200);break;case"options-list":setTimeout(function(){$("#song-list").hide(),$("#user-list").hide(),$("#menu-list").hide()},200),$("#song-list").animate({right:"0px"},200),$("#user-list").animate({right:"0px"},200),$("#menu-list").animate({right:"0px"},200),jQuery(window).width()>992&&$("#currently-playing").animate({width:"68%"},200)}else $(this).t=setTimeout(function(){$("#"+s).hide()},200),t="0px",window.innerWidth<768&&(n=window.innerHeight+1),jQuery(window).width()>992&&$("#currently-playing").animate({width:"100%",top:n},200);$("#"+s).animate({right:t,top:n},200)}).on("mouseenter","#body-chat",function(){window.chatHovered=!0}).on("mouseleave","#body-chat",function(){window.chatHovered=!1}).on("click",".quick-submit",function(){var e=getBoxToken(),s=document.getElementById($(this).attr("id")).dataset.target;addEntry(e,s,"solo")}).on("click",".quick-requeue",function(){var e=getBoxToken(),s=document.getElementById($(this).attr("id")).dataset.target;requeueSong(e,s)}).on("click","#save-room-button",function(){var e=getBoxToken();$.when(updateEntry("rooms",$("#form-box-details").serialize(),e)).done(function(e){console.log(e),$("#save-room-button").blur(),$("#save-room-button").text(language_tokens.save_changes_feedback),$("#save-room-button").switchClass("btn-primary","btn-success feedback",200,"easeOutBack"),setTimeout(function(){$("#save-room-button").switchClass("btn-success feedback","btn-primary",1e3,"easeInQuad"),$("#save-room-button").text(language_tokens.save_changes)},1500)})}).on("keyup",".url-box",function(){var e=$(".url-box").val();if(""!=e){$(".play-url").addClass("disabled"),$(".play-url").attr("disabled","disabled"),$(".play-url").text(language_tokens.searching);var s;s&&clearTimeout(s),s=setTimeout(function(){var s=new RegExp(/list=([a-z0-9\-\_]+)\&?/i),t=s.exec(e);if(null!=t)$(".url-box").blur(),$(".submit-warning").html("<span class='glyphicon glyphicon-ok'></span>"+language_tokens.submit_playlist_link),$(".submit-warning").addClass("system-success"),$(".submit-warning").removeClass("system-warning"),$(".play-url").removeClass("disabled"),$(".play-url").removeAttr("disabled"),$(".play-url").html("<span class='glyphicon glyphicon-circle-arrow-right resize-lg'></span> "+language_tokens.submit_link);else{var n=new RegExp(/\?v=([a-z0-9\-\_]+)\&?/i),o=n.exec(e);if(null==o||11!=o[1].length){var a=new RegExp(/\.be\/([a-z0-9\-\_]+)\&?/i),o=a.exec(e);null!=o&&11!=o[1].length?($(".url-box").blur(),$(".submit-warning").html("<span class='glyphicon glyphicon-ok'></span>"+language_tokens.submit_video_link),$(".submit-warning").addClass("system-success"),$(".submit-warning").removeClass("system-warning"),$(".play-url").removeClass("disabled"),$(".play-url").removeAttr("disabled"),$(".play-url").html("<span class='glyphicon glyphicon-circle-arrow-right resize-lg'></span> "+language_tokens.submit_link)):($(".submit-warning").html("<span class='glyphicon glyphicon-alert'></span> "+language_tokens.submit_no_link),$(".submit-warning").removeClass("system-success"),$(".submit-warning").addClass("system-warning"))}else $(".url-box").blur(),$(".submit-warning").html("<span class='glyphicon glyphicon-ok'></span>"+language_tokens.submit_video_link),$(".submit-warning").addClass("system-success"),$(".submit-warning").removeClass("system-warning"),$(".play-url").removeClass("disabled"),$(".play-url").removeAttr("disabled"),$(".play-url").html("<span class='glyphicon glyphicon-circle-arrow-right resize-lg'></span> "+language_tokens.submit_link)}},2e3)}else $(".submit-warning").empty()}).on("click",".btn-skip",function(){var e=getBoxToken();getNext(!0,e)}).on("click",".shuffle-playlist",function(){var e=getBoxToken();shufflePlaylist(e)}).on("click",".toggle-box-state",function(){var e=$(this),s=document.getElementById(e.attr("id")).dataset.field,t=document.getElementById(e.attr("id")).dataset.value,n={};n[s]=t;var o=getBoxToken();$.when(updateEntry("rooms",$.param(n),o)).done(function(){e.trigger("activate")})}).on("click",".swap-order",function(){var e=document.getElementById($(this).attr("id")),s=/(\w*)-(\d*)/.exec(e.id),t=s[1],n=s[2],o=getBoxToken(),a=e.dataset.order;console.log(n,a,t,o),$.post("functions/swap_playlist_order.php",{history_id:n,current_order:a,action:t,box_token:o}).done(function(e){loadPlaylist(o,!0)})}).on("click",".transfer-box",function(){var e=getBoxToken(),s=$(this).data("user");transferBox(e,s)});